podTemplate(label: 'testpod',containers: [
    containerTemplate(name: 'git', image: 'alpine/git', ttyEnabled: true, command: 'cat'),
    containerTemplate(name: 'gradle', image: 'gradle', ttyEnabled: true, command: 'cat'),
    containerTemplate(name: 'docker', image: 'docker', command: 'cat', ttyEnabled: true),
  ],
  volumes: [
    hostPathVolume(mountPath: '/var/run/docker.sock', hostPath: '/var/run/docker.sock')
  ] )
  {
node('testpod') {
    stage('Clone project'){
        container('git'){
            sh """
                git clone https://github.com/ronlevy1211/gradle-project.git
                """
        }
    }
    stage('Build Artifact'){
        container('gradle'){
            sh """
                cd gradle-project
                gradle build
                cp /home/jenkins/agent/workspace/gradle-project/gradle-project/build/libs/gradle-project.war ./gradle-project.war
                """
        }
    }
    stage('Build and Push Docker image'){
        container('docker'){
            sh """
                docker build -t ronlevy1211/hello-world ./gradle-project
                docker login --username ${Docker_user} --password ${Docker_pass} 
                docker push ronlevy1211/hello-world
                """
        }
    }
}
}
